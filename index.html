<!DOCTYPE html>
<html>
<head>
  <title>NFL Ticker</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      color: lime;
      font-family: Arial, sans-serif;
      font-size: 24px;
      overflow: hidden;
    }
    #ticker {
      display: flex;
      flex-direction: column;
      animation: scroll-up 20s linear infinite;
    }
    .score-row {
      display: flex;
      align-items: center;
      padding: 5px;
      border-bottom: 1px solid #444;
      transition: background-color 0.5s;
    }
    .flash {
      background-color: yellow !important;
      color: black !important;
    }
    .team-logo {
      width: 32px;
      height: 32px;
      margin: 0 10px;
    }
    .score-text {
      color: white;
    }
  </style>
</head>
<body>
  <div id="ticker"></div>

  <script>
    const sheetName = "Ticker";
    const sheetUrl = "https://docs.google.com/spreadsheets/d/1YNKX5NYN_OxAgnfPRnQqx57WG__LafLVXO9JCS3L5Xc/gviz/tq?tqx=out:json&sheet=" + sheetName;

    const teamColors = {
      "Arizona Cardinals": "#97233F",
      "Atlanta Falcons": "#A71930",
      "Baltimore Ravens": "#241773",
      "Buffalo Bills": "#00338D",
      "Carolina Panthers": "#0085CA",
      "Chicago Bears": "#0B162A",
      "Cincinnati Bengals": "#FB4F14",
      "Cleveland Browns": "#311D00",
      "Dallas Cowboys": "#041E42",
      "Denver Broncos": "#002244",
      "Detroit Lions": "#0076B6",
      "Green Bay Packers": "#203731",
      "Houston Texans": "#03202F",
      "Indianapolis Colts": "#002C5F",
      "Jacksonville Jaguars": "#006778",
      "Kansas City Chiefs": "#E31837",
      "Las Vegas Raiders": "#000000",
      "Los Angeles Chargers": "#002A5E",
      "Los Angeles Rams": "#003594",
      "Miami Dolphins": "#008E97",
      "Minnesota Vikings": "#4F2683",
      "New England Patriots": "#002244",
      "New Orleans Saints": "#D3BC8D",
      "New York Giants": "#0B2265",
      "New York Jets": "#125740",
      "Philadelphia Eagles": "#004C54",
      "Pittsburgh Steelers": "#FFB612",
      "San Francisco 49ers": "#AA0000",
      "Seattle Seahawks": "#002244",
      "Tampa Bay Buccaneers": "#D50A0A",
      "Tennessee Titans": "#0C2340",
      "Washington Commanders": "#5A1414"
    };

    const teamLogos = {
      "Arizona Cardinals": "https://a.espncdn.com/i/teamlogos/nfl/500/ari.png",
      "Atlanta Falcons": "https://a.espncdn.com/i/teamlogos/nfl/500/atl.png",
      "Baltimore Ravens": "https://a.espncdn.com/i/teamlogos/nfl/500/bal.png",
      "Buffalo Bills": "https://a.espncdn.com/i/teamlogos/nfl/500/buf.png",
      "Carolina Panthers": "https://a.espncdn.com/i/teamlogos/nfl/500/car.png",
      "Chicago Bears": "https://a.espncdn.com/i/teamlogos/nfl/500/chi.png",
      "Cincinnati Bengals": "https://a.espncdn.com/i/teamlogos/nfl/500/cin.png",
      "Cleveland Browns": "https://a.espncdn.com/i/teamlogos/nfl/500/cle.png",
      "Dallas Cowboys": "https://a.espncdn.com/i/teamlogos/nfl/500/dal.png",
      "Denver Broncos": "https://a.espncdn.com/i/teamlogos/nfl/500/den.png",
      "Detroit Lions": "https://a.espncdn.com/i/teamlogos/nfl/500/det.png",
      "Green Bay Packers": "https://a.espncdn.com/i/teamlogos/nfl/500/gb.png",
      "Houston Texans": "https://a.espncdn.com/i/teamlogos/nfl/500/hou.png",
      "Indianapolis Colts": "https://a.espncdn.com/i/teamlogos/nfl/500/ind.png",
      "Jacksonville Jaguars": "https://a.espncdn.com/i/teamlogos/nfl/500/jax.png",
      "Kansas City Chiefs": "https://a.espncdn.com/i/teamlogos/nfl/500/kc.png",
      "Las Vegas Raiders": "https://a.espncdn.com/i/teamlogos/nfl/500/lv.png",
      "Los Angeles Chargers": "https://a.espncdn.com/i/teamlogos/nfl/500/lac.png",
      "Los Angeles Rams": "https://a.espncdn.com/i/teamlogos/nfl/500/lar.png",
      "Miami Dolphins": "https://a.espncdn.com/i/teamlogos/nfl/500/mia.png",
      "Minnesota Vikings": "https://a.espncdn.com/i/teamlogos/nfl/500/min.png",
      "New England Patriots": "https://a.espncdn.com/i/teamlogos/nfl/500/ne.png",
      "New Orleans Saints": "https://a.espncdn.com/i/teamlogos/nfl/500/no.png",
      "New York Giants": "https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png",
      "New York Jets": "https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png",
      "Philadelphia Eagles": "https://a.espncdn.com/i/teamlogos/nfl/500/phi.png",
      "Pittsburgh Steelers": "https://a.espncdn.com/i/teamlogos/nfl/500/pit.png",
      "San Francisco 49ers": "https://a.espncdn.com/i/teamlogos/nfl/500/sf.png",
      "Seattle Seahawks": "https://a.espncdn.com/i/teamlogos/nfl/500/sea.png",
      "Tampa Bay Buccaneers": "https://a.espncdn.com/i/teamlogos/nfl/500/tb.png",
      "Tennessee Titans": "https://a.espncdn.com/i/teamlogos/nfl/500/ten.png",
      "Washington Commanders": "https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png"
    };

    function normalizeTeamName(name) {
      return name?.trim().toLowerCase();
    }

    let lastScores = [];

    function parseGoogleSheetJSON(text) {
      const jsonPrefix = "/*O_o*/\ngoogle.visualization.Query.setResponse(";
      const jsonSuffix = ");";
      if (!text.startsWith(jsonPrefix) || !text.endsWith(jsonSuffix)) {
        throw new Error("Unexpected Google Sheets JSON format");
      }
      const jsonString = text.substring(jsonPrefix.length, text.length - jsonSuffix.length);
      return JSON.parse(jsonString);
    }

    function loadScores() {
      fetch(sheetUrl)
        .then(res => res.text())
        .then(text => {
          let json;
          try {
            json = parseGoogleSheetJSON(text);
          } catch (e) {
            throw new Error("Failed to parse sheet data: " + e.message);
          }

          const rows = json.table.rows;
          const ticker = document.getElementById("ticker");
          ticker.innerHTML = "";

          if (rows.length === 0) {
            const msg = document.createElement("div");
            msg.className = "score-text";
            msg.textContent = "No NFL games currently available.";
            ticker.appendChild(msg);
            return;
          }

          const newScores = [];

          rows.forEach((row, index) => {
            const home = row.c[0]?.v;
            const homeScore = row.c[1]?.f || row.c[1]?.v;
            const away = row.c[2]?.v;
            const awayScore = row.c[3]?.f || row.c[3]?.v;

            const summary = `${away} ${awayScore} @ ${home} ${homeScore}`;
            const hasChanged = lastScores[index] !== summary;

            const div = document.createElement("div");
            div.className = "score-row";

            if (hasChanged && lastScores.length > 0) {
              div.classList.add("flash");
              setTimeout(() => div.classList.remove("flash"), 1000);
            }

            const normalizedAway = normalizeTeamName(away);
            const normalizedHome = normalizeTeamName(home);
            const logoKeys = Object.keys(teamLogos);
            const matchedAway = logoKeys.find(key => key.toLowerCase() === normalizedAway);
            const matchedHome = logoKeys.find(key => key.toLowerCase() === normalizedHome);

            const awayLogo = document.createElement("img");
            awayLogo.className = "team-logo";
            awayLogo.src = teamLogos[matchedAway] || "https://a.espncdn.com/i/teamlogos/nfl/500/nfl.png";

            const homeLogo = document.createElement("img");
            homeLogo.className = "team-logo";
            homeLogo.src = teamLogos[matchedHome] || "https://a.espncdn.com/i/teamlogos/nfl/500/nfl.png";

            const span = document.createElement("span");
            span.className = "score-text";
            span.textContent = summary;

            if (matchedHome && teamColors[matchedHome]) {
              div.style.backgroundColor = teamColors[matchedHome];
              span.style.color = "white";
            }

            div.appendChild(awayLogo);
            div.appendChild(span);
            div.appendChild(homeLogo);
            ticker.appendChild(div);

            newScores.push(summary);
          });

          lastScores = newScores;
        })
        .catch(err => {
          const errorMsg = document.createElement("div");
          errorMsg.className = "score-text";
          errorMsg.textContent = "Error loading scores. Please check the sheet ID or format.";
          document.getElementById("ticker").appendChild(errorMsg);
          console.error(err);
        });
    }

    loadScores();
    setInterval(loadScores, 300000);
  </script>
</body>
</html>
